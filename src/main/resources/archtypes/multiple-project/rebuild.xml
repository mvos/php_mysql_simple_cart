<?xml version="1.0" encoding="UTF-8"?>
<project name="ant-build-commons-archtype-multiple-project-rebuild" basedir="." default="rebuild">

    <target name="rebuild"
            depends="archtype:generate-build-file" />

    <target name="archtype:merge-build-files">

        <concat destfile="foo.xml" overwrite="true" fixlastline="true">
            <fileset dir="${basedir}/../../../xml/" includes="**/*.xml">
                <exclude name="archtypes/*.xml" />
            </fileset>
            <filterchain>
                <linecontains negate="true">
                    <contains value="&lt;?xml"/>
                    <contains value="version="/>
                </linecontains> 
            </filterchain>

            <header file="${basedir}/rebuild.header" />
            <footer file="${basedir}/rebuild.footer" />
        </concat>
    </target>

    <target name="archtype:generate-build-file"
            depends="archtype:merge-build-files">

        <xslt in="foo.xml" out="${basedir}/../../../xml/archtypes/multiple-project.xml" style="rebuild.xsl">
            
        </xslt>
    </target>
</project>
